<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Register & Login</title>
<style>
  body { font-family: Arial, sans-serif; background: #111; color: #eee; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0;}
  .container { background: #222; padding: 20px 30px; border-radius: 10px; width: 320px; box-shadow: 0 0 10px #0ff;}
  h2 { text-align: center; margin-bottom: 20px; }
  label { display: block; margin-top: 10px; }
  input[type="text"], input[type="password"] { width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; border: none; }
  button { margin-top: 20px; width: 100%; padding: 10px; background: #0ff; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
  button:hover { background: #0cc; }
  #switchBtn { margin-top: 10px; background: transparent; color: #0ff; border: none; cursor: pointer; text-decoration: underline; }
  #message { margin-top: 15px; height: 20px; text-align: center; }
  #forbiddenBtn { margin-top: 20px; background: red; color: white; font-weight: bold; }
</style>
</head>
<body>
  <div class="container" id="container">
    <!-- Register Form -->
    <div id="registerForm">
      <h2>Register</h2>
      <label for="regUsername">Username:</label>
      <input type="text" id="regUsername" autocomplete="off" />
      <label for="regPassword">Password:</label>
      <input type="password" id="regPassword" />
      <button id="registerBtn">Register</button>
      <button id="switchToLoginBtn">Switch to Login</button>
      <div id="registerMessage"></div>
    </div>

    <!-- Login Form -->
    <div id="loginForm" style="display:none;">
      <h2>Login</h2>
      <label for="loginUsername">Username:</label>
      <input type="text" id="loginUsername" autocomplete="off" />
      <label for="loginPassword">Password:</label>
      <input type="password" id="loginPassword" />
      <button id="loginBtn">Login</button>
      <button id="switchToRegisterBtn">Switch to Register</button>
      <div id="loginMessage"></div>
    </div>
  </div>

<script>
  // Users stored in localStorage
  let users = JSON.parse(localStorage.getItem('users') || '{}');

  const registerForm = document.getElementById('registerForm');
  const loginForm = document.getElementById('loginForm');

  const regUsername = document.getElementById('regUsername');
  const regPassword = document.getElementById('regPassword');
  const registerBtn = document.getElementById('registerBtn');
  const switchToLoginBtn = document.getElementById('switchToLoginBtn');
  const registerMessage = document.getElementById('registerMessage');

  const loginUsername = document.getElementById('loginUsername');
  const loginPassword = document.getElementById('loginPassword');
  const loginBtn = document.getElementById('loginBtn');
  const switchToRegisterBtn = document.getElementById('switchToRegisterBtn');
  const loginMessage = document.getElementById('loginMessage');

  // Show register form, hide login
  function showRegister() {
    registerForm.style.display = 'block';
    loginForm.style.display = 'none';
    clearRegisterFields();
    clearRegisterMessage();
  }

  // Show login form, hide register
  function showLogin() {
    registerForm.style.display = 'none';
    loginForm.style.display = 'block';
    clearLoginFields();
    clearLoginMessage();
    resetLoginForm(); // Make sure login page is normal on show
  }

  // Clear inputs & messages
  function clearRegisterFields() {
    regUsername.value = '';
    regPassword.value = '';
  }
  function clearRegisterMessage() {
    registerMessage.textContent = '';
  }
  function clearLoginFields() {
    loginUsername.value = '';
    loginPassword.value = '';
  }
  function clearLoginMessage() {
    loginMessage.textContent = '';
  }

  // Save users to localStorage
  function saveUsers() {
    localStorage.setItem('users', JSON.stringify(users));
  }

  // Reset login form to normal (show inputs + buttons)
  function resetLoginForm() {
    // Restore labels and inputs
    loginUsername.style.display = 'block';
    loginPassword.style.display = 'block';
    loginUsername.previousElementSibling.style.display = 'block'; // label
    loginPassword.previousElementSibling.style.display = 'block'; // label

    // Show buttons
    loginBtn.style.display = 'inline-block';
    switchToRegisterBtn.style.display = 'inline-block';

    // Change login button text
    loginBtn.textContent = 'Login';

    // Enable buttons
    loginBtn.disabled = false;
    switchToRegisterBtn.disabled = false;

    clearLoginMessage();
  }

  // After successful login, change login form to forbidden mode
  function setForbiddenMode() {
    // Hide username/password inputs and labels
    loginUsername.style.display = 'none';
    loginPassword.style.display = 'none';
    loginUsername.previousElementSibling.style.display = 'none'; // label
    loginPassword.previousElementSibling.style.display = 'none'; // label

    // Hide switch to register button
    switchToRegisterBtn.style.display = 'none';

    // Change login button to forbidden button
    loginBtn.textContent = 'Open the forbidden mohab link';
    loginBtn.disabled = false;

    clearLoginMessage();
  }

  // Event Listeners
  registerBtn.addEventListener('click', () => {
    const username = regUsername.value.trim();
    const password = regPassword.value;
    if (!username || !password) {
      registerMessage.style.color = 'red';
      registerMessage.textContent = 'Please enter username and password';
      return;
    }
    if (users[username]) {
      registerMessage.style.color = 'red';
      registerMessage.textContent = 'Username already exists';
      return;
    }
    users[username] = password;
    saveUsers();
    registerMessage.style.color = 'lime';
    registerMessage.textContent = 'Registered successfully! Redirecting to login...';
    clearRegisterFields();

    // After short delay, switch to login page
    setTimeout(() => {
      showLogin();
    }, 1200);
  });

  switchToLoginBtn.addEventListener('click', () => {
    showLogin();
  });

  switchToRegisterBtn.addEventListener('click', () => {
    showRegister();
  });

  loginBtn.addEventListener('click', () => {
    // If forbidden mode active (button says "Open the forbidden mohab link"), open link and reset
    if (loginBtn.textContent === 'Open the forbidden mohab link') {
      window.open('https://docs.google.com/document/d/17V0c42kK7rWt0fQr4QscPvdpojCMGOrtaEppNhSznmE/edit?usp=sharing', '_blank');
      resetLoginForm();
      clearLoginFields();
      return;
    }

    // Normal login process
    const username = loginUsername.value.trim();
    const password = loginPassword.value;
    if (!username || !password) {
      loginMessage.style.color = 'red';
      loginMessage.textContent = 'Please enter username and password';
      return;
    }
    if (users[username] && users[username] === password) {
      loginMessage.style.color = 'lime';
      loginMessage.textContent = 'Login successful!';
      setForbiddenMode();
    } else {
      loginMessage.style.color = 'red';
      loginMessage.textContent = 'Invalid username or password';
    }
  });

  // Start on register page
  showRegister();
</script>
</body>
</html>
